[user]
	name = Thijs Brobbel
[include]
	path = ~/.gitconfig-encrypted

{{- if eq .chezmoi.hostname "warmachine" }}
# [include]
[includeIf "gitdir:~/src/guida/**"]
	path = ~/.gitconfig-guida
{{- end }}

[init]
	defaultBranch = main
[fetch]
	prune = true
[rebase]
	updateRefs = true
[blame]
	markIgnoredLines = true
	markUnblamableLines = true

# [core]
# 	editor = gvim --nofork '%*'
	# TODO: Is this really needed?
# 	whitespace = cr-at-eol

# TODO: Probably not needed anymore...
# [http]
# 	cookiefile = ~/.gitcookies

[alias]
	la = "!git config -l | grep alias | cut -c 7-"

	co = checkout
	br = branch
	st = status
	cp = cherry-pick

	sts = status -s
	stsc = !git sts |cut -b4-

	lol = log --pretty=oneline --abbrev-commit --graph --decorate
	ls = log --pretty=format:"%C(green)%h\\ %C(yellow)[%ad]%Cred%d\\ %Creset%s%Cblue\\ [%cn]" --decorate --date=relative

	f = "!git ls-files | grep -i"

	ci = commit -v
	ca = commit -va

	updates = commit -v --amend -Chead
	updatea = commit -va --amend -Chead

	r = reset
	r1 = reset HEAD^
	r2 = reset HEAD^^
	rh = reset --hard
	rh1 = reset HEAD^ --hard
	rh2 = reset HEAD^^ --hard

	irebase = "rebase -i"
	iarebase = "rebase -i --autosquash"

	sl = stash list

	pu = !git push --set-upstream origin $(git branch --show-current)
	pushf = push --force-with-lease

	# # -o merge_request.create: https://docs.gitlab.com/ee/topics/git/commit.html#push-options-for-merge-requests
	pmr = !git push -o merge_request.create -o merge_request.remove_source_branch -o merge_request.assign='tiezmaster' -u origin $(git branch --show-current)
	pmra = !git push -o merge_request.create -o merge_request.remove_source_branch -o merge_request.merge_when_pipeline_succeeds -o merge_request.assign='tiezmaster' -u origin $(git branch --show-current)

	fp = fetch --prune --all
	pom = pull --ff-only origin main
	pum = pull --ff-only upstream main
	delete-merged-branches = !git br --merged | grep -v main |xargs --no-run-if-empty git br -d
	sync = !git co main && git pom && git fp && git push && git delete-merged-branches

	# Disabled

	# cii = !git commit -v --trailer=issue:$(git branch --show-current |cut -d / -f1 |tr '[:lower:]' '[:upper:]')
	# ca = !git commit -va --trailer=issue:$(git branch --show-current |cut -d / -f1 |tr '[:lower:]' '[:upper:]')

	# unstage = reset HEAD --
	# last = log -1 HEAD
	# stash-unapply = !git stash show -p | git apply -R
	# unmv = "!f() { git mv $2 $1; }; f"

	# add-upstream = remote add upstream
	# fa = fetch --all
	# puu = !git push --set-upstream upstream $(git branch --show-current)

	# Checkout PR branches, and cleanup
	# pr = "!f() { git fetch -fu ${2:-upstream} refs/pull/$1/head:pr/$1 && git checkout pr/$1; }; f"
	# pr-clean = "!git for-each-ref refs/heads/pr/* --format=\"%(refname)\" | while read ref ; do branch=${ref#refs/heads/} ; git branch -D $branch ; done"
