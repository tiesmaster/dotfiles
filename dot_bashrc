. ~/.bashrc.d/bash-history
. ~/.bashrc.d/homebrew
. ~/.bashrc.d/direnv
. ~/.bashrc.d/chezmoi
. ~/.bashrc.d/tere
. ~/.bashrc.d/starship
. ~/.bashrc.d/golang

. ~/.bashrc.d/k8s
[[ -f ~/.bashrc.d/guida ]] && . ~/.bashrc.d/guida

# Set env vars
export PATH=~/bin:~/.local/bin:~/go/bin:${PATH}
export EDITOR=vim
export LESS="FRXi"

export K9S_CONFIG_DIR=~/.config/k9s

# export DOTFILES_START_KUBIE_SUBSHELL_IMMEDIATELY=1

# Aliases

# aliases: general aliases
alias c='code .'

# aliases: meta: manage bash
alias eb='czew ~/.bashrc'
alias ek9s='czew ~/.config/k9s/hotkeys.yaml'
alias sb='. ~/.bashrc'

# aliases: git
alias gs='git status'
alias gb='git branch'
alias ga='git ca'
alias gd='git diff'

# aliases: lazy*
alias lzd='lazydocker'
alias lzg='lazygit'

# aliases: tailscale
alias ts=tailscale
alias tss='tailscale status'
alias tsp='tailscale ping'
alias tsh='tailscale ssh'

alias ts-enable-dns='tailscale up --accept-dns=true --accept-routes'
alias ts-disable-dns='tailscale up --accept-dns=false --accept-routes'

# 1Password
alias ops='op signin'

# aliases: docker compose
alias dc='docker compose'

# aliases: terraform
alias tf=terraform
alias tff='terraform fmt'
alias tfv='terraform validate'
alias tfr='terraform refresh'
alias tfp='terraform plan'
alias tfa='terraform apply'
alias tfd='terraform destroy'
alias tfyolo='terraform apply -auto-approve'
alias tfi='terraform init'
alias tfiu='terraform init -upgrade'

# aliases: minikube
alias mk=minikube
alias mks='minikube start'
alias mkd='minikube delete'

# aliases: personal projects
alias backup-golink='curl -s http://go/.export >~/tmp/backup/golink_`date +%F_%H-%M-%S`.jsonl'

alias ho='cd ~/src/private/homeops/'
alias tfc='cd ~/src/private/tfcleanup/'

# aliases: misc
alias r2='vlc ~/Documents/radio2.pls >/dev/null 2>&1 &'

# Completions
type talosctl &>/dev/null && . <(talosctl completion bash)

# Functions

# shellcheck disable=SC2164
mkcd() {
	mkdir -p "$@" && cd "$@";
}

git-tag-and-push() {
  git tag "$1"
  git push origin "$1"
}

if [[ -n "${DOTFILES_START_KUBIE_SUBSHELL_IMMEDIATELY}" ]] && type kubie &>/dev/null
then
  # Spawn a new kubie subshell, so there is no mixing between pre-and post kubie shell history.
  # There doesn't seem to be a native way to do this [1]. The con of this is that you always need to
  # exit twice, on leaving the shell.
  # [1] https://github.com/sbstp/kubie/issues/371
  kubie ctx jarvis
fi
